<!DOCTYPE html>

<html>

<head>

    <title>Herramienta de mapa</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- reference to Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""/>

    <!-- reference to Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
      integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
      crossorigin=""></script>

    <!-- reference to jquery -->
    <script src="src/jquery-2.1.1.min.js"></script>
    <!-- reference to ajax -->
    <script src="src/leaflet.ajax.min.js"></script>

    <!-- Load Esri Leaflet from CDN -->
     <script src="https://unpkg.com/esri-leaflet@2.3.0/dist/esri-leaflet.js"
     integrity="sha512-1tScwpjXwwnm6tTva0l0/ZgM3rYNbdyMj5q6RSQMbNX6EUMhYDE3pMRGZaT41zHEvLoWEK7qFEJmZDOoDMU7/Q=="
     crossorigin=""></script>


     <!-- Load Esri Leaflet Geocoder from CDN -->

      <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.css"
      integrity="sha512-v5YmWLm8KqAAmg5808pETiccEohtt8rPVMGQ1jA6jqkWVydV5Cuz3nJ9fQ7ittSxvuqsvI9RSGfVoKPaAJZ/AQ=="
      crossorigin="">
      <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.js"
      integrity="sha512-uK5jVwR81KVTGe8KpJa1QIN4n60TsSV8+DPbL5wWlYQvb0/nYNgSOg9dZG6ViQhwx/gaMszuWllTemL+K+IXjg=="
      crossorigin=""></script>

    <!-- Load Leaflet search para buscar sectores en la capa -->
      <link rel="stylesheet" href="src/leaflet-search.src.css"/>
      <script src="src/leaflet-search.src.js"></script>


    <!-- Load Grouped Layer Control -->
      <link rel="stylesheet" href="src/leaflet.groupedlayercontrol.min.css">
      <script src="src/leaflet.groupedlayercontrol.min.js" type="text/javascript"></script>

    <!-- Load Font Awesome icons -->
      <script src="https://use.fontawesome.com/a64989e3a8.js"></script>

    <!-- Load Leaflet locate -->
    <link rel="stylesheet" href="src/L.Control.Locate.min.css" />
    <script src="src/L.Control.Locate.min.js"></script>

    <!-- set width and height styles for map -->
    <style>
        body {
          padding: 0;
          margin: 0;
        }
        html,
        body,
        #map {
    			height: 100%;
          }


    </style>

</head>

<body>

    <!-- place holder for map -->
    <div id="map"></div>
    <script>

      //
      var map;
      var lyrCarto;
      var lyrMapbox;
      // declare layer Erosion costera
      var lyr30yrCoastalEro;

      // declare layer Aumento del nivel del mar 3 pies
      var lyrSLR3ft;

      // declare layer inundacion
      var lyrFlood;

      // declare layer Sectores
      var lyrSectores;


      // declare layer Colmados
      var lyrColmados;
      // declare layer Farmacias
      var lyrFarmacias;
      // declare layer Instreligiosa
      var lyrInsreligiosa;
      // declare layer Refugios
      var lyrRefugios;
      // declare layer Cntresiliencia
      var lyrCntresiliencia;
      // declare layer Hospitales
      var lyrHospitales;
      // declare Buffer layer Colmados
      var bufColmados;
      // declare Buffer layer Farmacias
      var bufFarmacias;
      // declare Buffer layer Instreligiosa
      var bufInsreligiosa;
      // declare Buffer layer Refugios
      var bufRefugios;
      // declare Buffer layer Cntresiliencia
      var bufCntresiliencia;
      // declare Buffer layer Hospitales
      var bufHospitales;

      var searchsector;

      var ctlLayers;
      var baseLayers;
      var groupedOverlays;
      var scale;

      // create custom icon
      var imgcasa = L.icon({
          iconUrl: 'img/houses.svg',
          iconSize: [5, 10], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgedificio = L.icon({
          iconUrl: 'img/hotel.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgcolmado = L.icon({
          iconUrl: 'img/shop.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imginstreligiosa = L.icon({
          iconUrl: 'img/christian-church.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgcntresiliencia = L.icon({
          iconUrl: 'img/shelter.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgfarmacia = L.icon({
          iconUrl: 'img/medicine.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgrefugios = L.icon({
          iconUrl: 'img/refugio.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imghospital = L.icon({
          iconUrl: 'img/hospital.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });

      //Styles para las capas de poligonos
      var stSlr3ft = {
          "color": "#00FFFF",
          "weight": 0,
          "opacity": 0.5
      };
      var stCoastEro = {
          "color": "#fff233",
          "weight": 3,
          "opacity": 0.5
      };
      var stfldhazVE = {
          "color": "#9e0142",
          "weight": 5,
          "opacity": 0.20
      };
      var stfldhazCoastA = {
          "color": "#d14b88",
          "weight": 5,
          "opacity": 0.65
      };
      var stfldhazCoastAFldwy = {
          "color": "#cf374d",
          "weight": 5,
          "opacity": 0.65
      };
      var stfldhazAE = {
          "color": "#e2ad0d",
          "weight": 5,
          "opacity": 0.65
      };
      var stfldhazAEFldwy = {
          "color": "#e66b1e",
          "weight": 5,
          "opacity": 0.65
      };
      var stfldhazAO = {
          "color": "#57cde2",
          "weight": 5,
          "opacity": 0.65
      };
      var stfldhazA = {
          "color": "#94d4a4",
          "weight": 5,
          "opacity": 0.65
      };
      var stfldhazAFldwy = {
          "color": "#5ab5ab",
          "weight": 5,
          "opacity": 0.65
      };

      //  create map object, tell it to live in 'map' div and give initial latitude, longitude, zoom values
      map = L.map('map',{
          maxZoom: 18,
          minZoom: 10,
          maxBounds: [
            //south west
            [17.74140,-68.14912],
            //north east
            [18.52795,-65.06509]
          ],
      }).setView([18.253579, -66.378914],10);

      //locate user button
      var lc = L.control.locate({
          position: 'topleft',
          strings: {
              title: "Localízame",
              popup: "Usted está en esta área"
          },
          locateOptions: {
               enableHighAccuracy: true
          }
      }).addTo(map);

      //  create basemaps, one satellite image, one base
      lyrCarto = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',{
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: 'abcd',
          maxZoom: 19
      }).addTo(map);

      lyrMapbox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoicm9ibW94IiwiYSI6IlhmNzNzUDQifQ.vnJhPuC_QNdWV2kQtF2P8w', {
          maxZoom: 19,
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
          '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
          'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
          id: 'mapbox.streets-satellite'
      });

      baseLayers = {
         "Mapa base": lyrCarto,
         "Imagen aérea": lyrMapbox
      };

      //Añadir los riesgos
      lyr30yrCoastalEro = L.geoJSON.ajax('data/30yrcoastero.geojson',{
          style: stCoastEro,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Erosión costera a 30 años");
          }
      });

      lyrSLR3ft = L.geoJSON.ajax('data/slr3ftinland.geojson',{
          style: stSlr3ft,
          onEachFeature: function (feature, layer) {
          layer.bindPopup("Aumento del nivel del mar 3ft");
          }
      });
      //Añade capas de inundación desagregadas
      lyrVE = L.geoJSON.ajax('data/FldhazVE.geojson',{
          style: stfldhazVE,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación VE");
          }
      });
      lyrAEoeste = L.geoJSON.ajax('data/FldhazAEoeste.geojson',{
          style: stfldhazAE,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación AE");
          }
      });
      lyrAEeste = L.geoJSON.ajax('data/FldhazAEeste.geojson',{
          style: stfldhazAE,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación AE");
          }
      });
      lyrAEcent1 = L.geoJSON.ajax('data/FldhazAEcent1.geojson',{
          style: stfldhazAE,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación AE");
          }
      });
      lyrAEcent2 = L.geoJSON.ajax('data/FldhazAEcent2.geojson',{
          style: stfldhazAE,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación AE");
          }
      });
      lyrAEFldwy = L.geoJSON.ajax('data/FldhazAEFldwy.geojson',{
          style: stfldhazAEFldwy,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación AE Cauce Mayor");
          }
      });
      lyrCoastA = L.geoJSON.ajax('data/FldhazCoastA.geojson',{
          style: stfldhazCoastA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A Costera");
          }
      });
      lyrCoastAFldwy = L.geoJSON.ajax('data/FldhazCoastAFldwy.geojson',{
          style: stfldhazCoastAFldwy,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A Costera Cauce Mayor");
          }
      });
      lyrAFldwy = L.geoJSON.ajax('data/FldhazAFldwy.geojson',{
          style: stfldhazAFldwy,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A Cauce Mayor");
          }
      });
      lyrAoeste1 = L.geoJSON.ajax('data/FldhazAoeste1.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAoeste2 = L.geoJSON.ajax('data/FldhazAoeste2.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAeste1 = L.geoJSON.ajax('data/FldhazAeste1.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAeste2 = L.geoJSON.ajax('data/FldhazAeste2.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAcent1 = L.geoJSON.ajax('data/FldhazAcent1.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAcent2 = L.geoJSON.ajax('data/FldhazAcent2.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAcent3 = L.geoJSON.ajax('data/FldhazAcent3.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });
      lyrAcent4 = L.geoJSON.ajax('data/FldhazAcent4.geojson',{
          style: stfldhazA,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación A");
          }
      });

      lyrAO = L.geoJSON.ajax('data/FldhazAO.geojson',{
          style: stfldhazAO,
          onEachFeature: function (feature, layer) {
            layer.bindPopup("Inundación AO");
          }
      });
      //agrupa las capas de inundación en un Layer Group
      var lyrFlood = L.layerGroup([lyrVE, lyrAEoeste, lyrAEeste, lyrAEcent1, lyrAEcent2, lyrAEFldwy, lyrCoastA, lyrCoastAFldwy, lyrAFldwy, lyrAoeste1, lyrAeste1, lyrAoeste2, lyrAeste2, lyrAcent1, lyrAcent2, lyrAcent3, lyrAcent4, lyrAO]);


      //añadir los sectores
      lyrSectores = L.geoJSON.ajax('data/sectores.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imgcasa});
          },
      });

      //add layers Centros de servicios then combine into LayerGroup
      lyrColmados = L.geoJSON.ajax('data/colmados.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imgcolmado});
          },
          onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.COMPANY_NAME);
          }
      });
      bufColmados = L.geoJSON.ajax('data/buff_colmados.geojson',{
          style: function (feature) {
            return {};
          },
      });
      var Colmados = L.layerGroup([lyrColmados,bufColmados]);

      lyrFarmacias = L.geoJSON.ajax('data/farmacias.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imgfarmacia});
          },
          onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.COMPANY_NAME);
          }
      });
      bufFarmacias = L.geoJSON.ajax('data/buff_farmacias.geojson',{
          style: function (feature) {
            return {};
          },
      });
      var Farmacias = L.layerGroup([lyrFarmacias,bufFarmacias]);

      lyrInsreligiosa = L.geoJSON.ajax('data/instreligiosa.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imginstreligiosa});
          },
          onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.COMPANY_NAME);
          }
      });
      bufInsreligiosa = L.geoJSON.ajax('data/buff_instreligiosa.geojson',{
          style: function (feature) {
            return {};
          },
      });
      var Instreligiosas = L.layerGroup([lyrInsreligiosa,bufInsreligiosa]);

      lyrRefugios = L.geoJSON.ajax('data/refugios_aemead.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imgrefugios});
          },
          onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.NOMBRE);
          }
      });
      bufRefugios = L.geoJSON.ajax('data/buff_refugios.geojson',{
          style: function (feature) {
            return {};
          },
      });
      var Refugios = L.layerGroup([lyrRefugios,bufRefugios]);

      lyrHospitales = L.geoJSON.ajax('data/hospitales.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imghospital});
          },
          onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.NOMBRE);
          }
      });
      bufHospitales = L.geoJSON.ajax('data/buff_hospitales.geojson',{
          style: function (feature) {
            return {};
          },
      });
      var Hospitales = L.layerGroup([lyrHospitales,bufHospitales]);

      lyrCntresiliencia = L.geoJSON.ajax('data/cnts_resiliencia.geojson',{
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: imgcntresiliencia});
          },
          onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.Organizati);
          }
      });
      bufCntresiliencia = L.geoJSON.ajax('data/buff_cnts_resiliencia.geojson',{
          style: function (feature) {
            return {};
          },
      });
      var CntsResiliencia = L.layerGroup([lyrCntresiliencia,bufCntresiliencia]).addTo (map);


           //Overlay grouped layers
          groupedOverlays = {
            "Riesgos": {
              "Erosión costera a 30 años": lyr30yrCoastalEro,
              "Aumento del nivel del mar 3ft": lyrSLR3ft,
              "Áreas inundables": lyrFlood
            },
            "Centros de servicio": {
              "<img src='img/houses.svg'height=18> Sectores": lyrSectores,
              "<img src='img/shop.svg'height=18> Colmados": Colmados,
              "<img src='img/medicine.svg'height=18> Farmacias": Farmacias,
              "<img src='img/christian-church.svg'height=18> Instituciones religiosas": Instreligiosas,
              "<img src='img/refugio.svg'height=18> Refugios": Refugios,
              "<img src='img/hospital.svg'height=18> Hospitales": Hospitales,
              "<img src='img/shelter.svg'height=18> Centros de Resiliencia": CntsResiliencia
            }
          };

          //ctlLayers = L.control.groupedLayers(objBasemaps, groupedOverlays).addTo(map);
          L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);

          //add scale bar to map
          scale = L.control.scale().addTo(map);


          //add search control to layer sectores
          /*var searchControl = new L.Control.Search({
          		layer: lyrSectores,
          		propertyName: 'NOMBRE',
          		marker: false,
          		moveToLocation: function(latlng, title, map) {
          			//map.fitBounds( latlng.layer.getBounds() );
          			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
            			map.setView(latlng, zoom); // access the zoom
          		}
          	});

          	searchControl.on('search:locationfound', function(e) {

          		//console.log('search:locationfound', );

          		//map.removeLayer(this._markerSearch)

          		e.layer.setStyle({fillColor: '#3f0', color: '#0f0'});
          		if(e.layer._popup)
          			e.layer.openPopup();

          	}).on('search:collapsed', function(e) {

          		featuresLayer.eachLayer(function(layer) {	//restore feature color
          			featuresLayer.resetStyle(layer);
          		});
          	});

          	map.addControl( searchControl );  //inizialize search control*/








</script>

</body>

</html>
