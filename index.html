<!DOCTYPE html>

<html>

<head>

    <title>Herramienta de mapa</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- reference to Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""/>

    <!-- reference to Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
      integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
      crossorigin=""></script>

    <!-- reference to jquery -->
    <script src="src/jquery-2.1.1.min.js"></script>
    <!-- reference to ajax -->
    <script src="src/leaflet.ajax.min.js"></script>

    <!-- Load Esri Leaflet from CDN -->
     <script src="https://unpkg.com/esri-leaflet@2.3.0/dist/esri-leaflet.js"
     integrity="sha512-1tScwpjXwwnm6tTva0l0/ZgM3rYNbdyMj5q6RSQMbNX6EUMhYDE3pMRGZaT41zHEvLoWEK7qFEJmZDOoDMU7/Q=="
     crossorigin=""></script>


     <!-- Load Esri Leaflet Geocoder from CDN -->

      <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.css"
      integrity="sha512-v5YmWLm8KqAAmg5808pETiccEohtt8rPVMGQ1jA6jqkWVydV5Cuz3nJ9fQ7ittSxvuqsvI9RSGfVoKPaAJZ/AQ=="
      crossorigin="">
      <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.js"
      integrity="sha512-uK5jVwR81KVTGe8KpJa1QIN4n60TsSV8+DPbL5wWlYQvb0/nYNgSOg9dZG6ViQhwx/gaMszuWllTemL+K+IXjg=="
      crossorigin=""></script>

    <!-- Load Leaflet search para buscar sectores en la capa -->
      <link rel="stylesheet" href="src/leaflet-search.src.css"/>
      <script src="src/leaflet-search.src.js"></script>
      <link rel="stylesheet" href="style.css" />

    <!-- Load Grouped Layer Control -->
      <link rel="stylesheet" href="src/leaflet.groupedlayercontrol.min.css">
      <script src="src/leaflet.groupedlayercontrol.min.js" type="text/javascript"></script>

    <!-- Load Font Awesome icons -->
      <script src="https://use.fontawesome.com/a64989e3a8.js"></script>


    <!-- set width and height styles for map -->
    <style>
        body {
          padding: 0;
          margin: 0;
        }
        html,
        body,
        #map {
    			height: 100%;
          }


    </style>

</head>

<body>

    <!-- place holder for map -->
    <div id="map"></div>
    //<div class='pointer'><< Click search button</div>
    <script>

      //
      var map;
      var lyrCarto;
      var lyrMapbox;
      // declare layer Erosion costera
      var lyr30yrCoastalEro;

      // declare layer Aumento del nivel del mar 3 pies
      var lyrSLR3ft;

      // declare layer inundacion
      var lyrFlood;

      // declare layer Sectores
      var lyrSectores;


      // declare layer Colmados
      var lyrColmados;
      // declare layer Farmacias
      var lyrFarmacias;
      // declare layer Instreligiosa
      var lyrInsreligiosa;
      // declare layer Refugios
      var lyrRefugios;
      // declare layer Cntresiliencia
      var lyrCntresiliencia;
      // declare layer Hospitales
      var lyrHospitales;
      // declare Buffer layer Colmados
      var bufColmados;
      // declare Buffer layer Farmacias
      var bufFarmacias;
      // declare Buffer layer Instreligiosa
      var bufInsreligiosa;
      // declare Buffer layer Refugios
      var bufRefugios;
      // declare Buffer layer Cntresiliencia
      var bufCntresiliencia;
      // declare Buffer layer Hospitales
      var bufHospitales;

      var searchsector;

      var ctlLayers;
      var baseLayers;
      var groupedOverlays;
      var scale;

      // create custom icon
      var imgcasa = L.icon({
          iconUrl: 'img/houses.svg',
          iconSize: [5, 10], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgedificio = L.icon({
          iconUrl: 'img/hotel.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgcolmado = L.icon({
          iconUrl: 'img/shop.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imginstreligiosa = L.icon({
          iconUrl: 'img/christian-church.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgcntresiliencia = L.icon({
          iconUrl: 'img/shelter.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgfarmacia = L.icon({
          iconUrl: 'img/medicine.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imgrefugios = L.icon({
          iconUrl: 'img/refugio.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var imghospital = L.icon({
          iconUrl: 'img/hospital.svg',
          iconSize: [15, 25], // size of the icon
          popupAnchor: [0,-15] // point from which the popup should open relative to the iconAnchor
          });
      var slr3ftstyle = {
          "color": "#00FFFF",
          "weight": 5,
          "opacity": 0.65
          };

          //  create map object, tell it to live in 'map' div and give initial latitude, longitude, zoom values
          map = L.map('map',{
                  center: [18.253579, -66.378914],
                  zoom: 10,
          });
          //  create basemaps, one satellite image, one base
          lyrCarto = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',{
                  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                  subdomains: 'abcd',
                  maxZoom: 19
                }).addTo(map);

          lyrMapbox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoicm9ibW94IiwiYSI6IlhmNzNzUDQifQ.vnJhPuC_QNdWV2kQtF2P8w', {
                  maxZoom: 19,
                  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                  '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                  'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                  id: 'mapbox.streets-satellite'
                  });


          baseLayers = {
                 "Mapa base": lyrCarto,
                 "Imagen aérea": lyrMapbox
               };
          lyr30yrCoastalEro = L.geoJSON.ajax('data/30yrcoastero.geojson',{
              style: function (feature) {
              return {color: "#00FFFF"};
              },
              onEachFeature: function (feature, layer) {
              layer.bindPopup("Erosión costera a 30 años");
              }
              });

          lyrSLR3ft = L.geoJSON.ajax('data/slr3ftinland.geojson',{
              style: function (feature) {
              return {};
              },
              onEachFeature: function (feature, layer) {
              layer.bindPopup("Aumento del nivel del mar 3ft");
              }
              });

          lyrFlood = L.geoJSON.ajax('data/fldhazdiss.geojson',{
              style: function (feature) {
              return {};
              },
              onEachFeature: function (feature, layer) {
              layer.bindPopup("Inundación");
              }
              });


          lyrSectores = L.geoJSON.ajax('data/sectores.geojson',{
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {icon: imgcasa});
                },
              });
          lyrColmados = L.geoJSON.ajax('data/colmados.geojson',{
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {icon: imgcolmado});
                },
              });
          lyrFarmacias = L.geoJSON.ajax('data/farmacias.geojson',{
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {icon: imgfarmacia});
                },
              });
          lyrInsreligiosa = L.geoJSON.ajax('data/instreligiosa.geojson',{
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {icon: imginstreligiosa});
                },
              });
          lyrRefugios = L.geoJSON.ajax('data/refugios_aemead.geojson',{
              pointToLayer: function(feature, latlng) {
                  return L.marker(latlng, {icon: imgrefugios});
                },
              });
          lyrHospitales = L.geoJSON.ajax('data/hospitales.geojson',{
              pointToLayer: function(feature, latlng) {
                  return L.marker(latlng, {icon: imghospital});
                },
              });
          lyrCntresiliencia = L.geoJSON.ajax('data/cnts_resiliencia.geojson',{
              pointToLayer: function(feature, latlng) {
                  return L.marker(latlng, {icon: imgcntresiliencia});
                  },
              }).addTo (map);
          bufFarmacias = L.geoJSON.ajax('data/buff_farmacias.geojson',{
              style: function (feature) {
              return {};
              },
          }).addTo (map);

          groupedOverlays = {
            "Riesgos": {
              "Erosión costera a 30 años": lyr30yrCoastalEro,
              "Aumento del nivel del mar 3ft": lyrSLR3ft,
              "Áreas inundables": lyrFlood
            },
            "Centros de servicio": {
              "<img src='img/houses.svg'height=18> Sectores": lyrSectores,
              "<img src='img/shop.svg'height=18> Colmados": lyrColmados,
              "<img src='img/medicine.svg'height=18> Farmacias": lyrFarmacias,
              "<img src='img/christian-church.svg'height=18> Inst religiosas": lyrInsreligiosa,
              "<img src='img/refugio.svg'height=18> Refugios": lyrRefugios,
              "<img src='img/hospital.svg'height=18> Hospitales": lyrHospitales,
              "<img src='img/shelter.svg'height=18> Centros de Resiliencia": lyrCntresiliencia
            }
          };

          //ctlLayers = L.control.groupedLayers(objBasemaps, groupedOverlays).addTo(map);
          L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);

          //add scale bar to map
          scale = L.control.scale().addTo(map);


          //add search control to layer sectores
          var searchControl = new L.Control.Search({
          		layer: lyrSectores,
          		propertyName: 'NOMBRE',
          		marker: false,
          		moveToLocation: function(latlng, title, map) {
          			//map.fitBounds( latlng.layer.getBounds() );
          			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
            			map.setView(latlng, zoom); // access the zoom
          		}
          	});

          	searchControl.on('search:locationfound', function(e) {

          		//console.log('search:locationfound', );

          		//map.removeLayer(this._markerSearch)

          		e.layer.setStyle({fillColor: '#3f0', color: '#0f0'});
          		if(e.layer._popup)
          			e.layer.openPopup();

          	}).on('search:collapsed', function(e) {

          		featuresLayer.eachLayer(function(layer) {	//restore feature color
          			featuresLayer.resetStyle(layer);
          		});
          	});

          	map.addControl( searchControl );  //inizialize search control








</script>

</body>

</html>
